
@{
    ViewData["Title"] = "Companies";
}

<script>
    var companydata = [];
    var url = "";
    var Pages;
    $(function () {
        getUsers();
        getPages = JSON.parse(localStorage.getItem('Pages'));
        Pages = getPages.find(dx => dx.PageName == "Company");
        if (Pages.Create == true) {
            $("#createCompany").show();
        }
        else {
            $("#createCompany").hide();
        }
    });

    function getUsers() {
        $.get('/Company/GetCompanies', function (data) {
            var companydata = data;
            console.log(companydata)
            Companygrid(companydata);
        });
    }


    function Companygrid(companydata) {

        $("#gridContainer").dxDataGrid({
            dataSource: companydata,
            keyExpr: "CompanyId",
            showBorders: true,
            columnAutoWidth: true,
            allowColumnResizing: true,
            columnHidingEnabled: true,
            hoverStateEnabled: true,
            rowAlternationEnabled: true,
            paging: {
                pageSize: 10
            },
            editing: {
                mode: 'row',
                allowUpdating(e) {
                    if (Pages.Update == true) {
                        return e;
                    }
                },
                allowDeleting(e) {
                    if (Pages.Delete == true) {
                        return e;
                    }
                }, 
                 useIcons: true
            },
            columnsAutoWidth: true,
            allowColumnReordering: true,
            showBorders: true,
            filterRow: {
                visible: true,
                applyFilter: "auto"
            },
            searchPanel: {
                visible: true,
                placeholder: "Search..."
            },
            export: {
                enabled: true,
            },
            onExporting: function (e) {
                console.log(e, "e");
                e.fileName = "Company List"
            },
            headerFilter: {
                visible: true
            },
            columns: [
                {
                    dataField: "FilePath",
                    caption: "Logo",
                     width: "90",
                    allowFiltering: false,
                    allowSorting: false,
                    cellTemplate: function (container, options) {

                        $("<div style='height: 55px;'>")
                            .appendTo(container)
                            .append($("<img>", { "src": url + "/" + options.value, "style": "display: block;width:100%; height: 100%;object-fit: contain;" }))

                    }
                },
                {
                    dataField: "CompanyId",
                    allowEditing: false,
                    width: 70
                },
                {
                    dataField: "CompanyName",
                    caption: "Name",
                },
                {
                    dataField: "Email", 
                },
                //{
                //    dataField: "Phone" 
                //},
                {
                    dataField: "Address", 
                },   
                {
                    dataField: "Status",
                    caption: "Status",
                    dataType: "boolean" 
                }
            ],

            summary: {
                totalItems: [{
                    column: 'CompanyId',
                    summaryType: 'count',
                }]
            },

            onEditingStart: function (e) {
                var cmp = e.data.CompanyId;
                console.log(cmp, "cmpiD");
                top.location.href = '/Company/UpdateCompany?id=' + cmp;
            },
            onRowRemoved: function (e) {
                console.log(e);
                var key = e.data.CompanyId;
                $.post('/Company/DeleteCompany?key=' + key, function (data) {
                    if (data) {
                        toastr.error('Deleted Successfully');
                    }
                });
            },

            //onToolbarPreparing: function (e)
            //{
            //    var dataGrid = e.component;
            //    e.toolbarOptions.items.unshift({
            //        location: "after",
            //        widget: "dxButton",
            //        visible: function (e) {
            //            console.log(e, 'e');
            //            if (Pages && Pages.Create == true) {
            //                return e;
            //            }
            //            else {
            //                return e.column.visible = false;
            //            }
            //        },
            //        options: {
            //            icon: "add",
            //            //stylingMode: 'outlined',
            //            type: 'default',
            //            text: 'Add New Company', 
            //            onClick: function () {
            //                top.location.href = '/Company/AddCompany';
            //            }
            //        }
            //    });
            //},   


        });
    }
</script>

<style>
    .sb-nav-fixed #layoutSidenav #layoutSidenav_content {
        top: 23px;
    }
</style>


<div class="row">
<div class="col-12">
    <div class="card">

        <div class="card-header">
            <h3 style="display: inline-block;">Company</h3>
            <button type="button" onclick="location.href='/Company/AddCompany'" id="createCompany" class="btn btn-info btn-fw float-right">Add New Company</button>
        </div>

        <div class="card-body">
            @*<h4 class="card-title">Company</h4>*@

            <div id="gridContainer"></div>
        </div>
    </div>
</div>
</div>


<div class="row">
    <div class="modal fade" id="ignismyModal" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label=""><span>×</span></button>
                </div>

                <div class="modal-body">
                    <div class="thank-you-pop">
                        <img src="~/img/Succcess_Image.png" alt="" class="">
                        <h1>Successfully Updated!</h1>
                    </div>

                </div>

            </div>
        </div>
    </div>
</div>
 