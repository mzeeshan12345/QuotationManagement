 @{
    ViewData["Title"] = "Update User";
}

<script>
    var roles = [];
    var dropDownValue;
    var regiondropDown;

  $(function () {
      GetRoles();
      GetRegions();
    });

            function GetRegions() {
         $.get('@Url.Action("GetRegions", "Admin")', function (data) {
             regions = data;
             console.log(regions, "Regions");
             $('#userRegions').dxTagBox({
                 searchEnabled: true,
                 placeholder: 'Choose or type Region',
                 dataSource: new DevExpress.data.ArrayStore({
                     data: regions,
                     key: 'RegionId',
                 }),
                 displayExpr: 'Name',
                 valueExpr: 'Name',
                 onValueChanged(e) {
                     regiondropDown = e.value;
                 },
             });
        });
    }


    function GetRoles() {
         $.get('@Url.Action("GetRoles", "Admin")', function (data) {
            roles = data;
             console.log(roles, "RolEs");
             $('#productsDataSource').dxTagBox({
                 searchEnabled: true,
                 placeholder: 'Choose or type role name',
                 dataSource: new DevExpress.data.ArrayStore({
                     data: roles,
                     key: 'Id',
                 }),
                 displayExpr: 'Name',
                 valueExpr: 'Name',
                 onValueChanged(e) {
                     console.log(e, "e");
                     dropDownValue = e.value;
                 },
             });
        });
    }

    function checkValidations() {

        if (!$('#FirstName').val()) {
            toastr.error('First Name is required');
        }
        if (!$('#LastName').val()) {

            toastr.error('Last Name is required');
        }

        if (!$('#Company').val()) {

            toastr.error('Company is required');
        }

        if (!$('#PhoneNumber').val()) {

            toastr.error('Phone is required');
        }


        if (!$('#Email').val()) {

            toastr.error('Email is required');
        }


        if (!$('#Designation').val()) {

            toastr.error('Designation is required');
        }

        //if (!$('#DateOfBirth').val()) {
        //    toastr.error('Dob is required');
        //}


    }

    function _calculateAge() {
        var today = new Date();
        var dob = new Date($('#DateOfBirth').val());
        var age = today.getFullYear() - dob.getFullYear();
        if (age < 13) {
            //$('#DobError').html('Your age must be 18+');
            toastr.error('Your age must be 13+');
            return false;
        }
        else {
            return true;
        }

    }

    function emailValidation() {
        value = document.getElementById('Email').value;
        apos = value.indexOf("@@");
        dotpos = value.lastIndexOf(".");
        lastpos = value.length - 1;
        if (apos < 1 || dotpos - apos < 2 || lastpos - dotpos > 3 || lastpos - dotpos < 2) {
            //$('#EmailError').html('Invalid Email Address');
            toastr.error('Invalid Email Address');
            return false;
        } else {
            return true;
        }
    }

    function onSubmit() {
        var d = document.getElementById('userInfo');
        if (d.checkValidity() && emailValidation() == true && validateMobile() == true) {
            var model = $('#userInfo').serialize()
            console.log(model, "model");
            /* $.post("/Admin/PostRegisteration?" + model, function (data) {*/
            $.post('/Admin/UpdateRegisteration?' + model, { roles: dropDownValue, regions: regiondropDown }, function (data) {
                console.log(data.result, "Return");
                if (data.result == true) {
                    toastr.success('Success');
                    setTimeout(function () {
                        window.location.reload();
                    }, 3000);
                }
                else {
                    setTimeout(function () {
                        toastr.error('Error!');
                    }, 2000);

                };
            });
        }
        checkValidations();
    }



    function formatDate(date) {
        var day = date.getDate();
        var month = date.getMonth() + 1;
        var year = date.getFullYear();

        var formatted = year + "-" + (month < 10 ? "0" : "") + month + "-" + (day < 10 ? "0" : "") + day;
        return formatted;
    }

    function formatTime(date) {
        var hour = date.getHours();
        var min = date.getMinutes();

        var formatted = hour + ":" + (min < 10 ? "0" : "") + min;
        return formatted;
    }


    function validateMobile() {

        reg = /^(?:02|03|04|06|07|09|050|051|052|054|055|056|058)[0-9]{7}$/;

        if (!reg.test($('#PhoneNumber').val())) {
            toastr.error('Invalid mobile number');
            return false;
        }
        else {
            return true;
        }
    }

</script>


<div class="card shadow mb-4">
    <!-- Card Header - Accordion -->
    <a href="#collapseCardExample" class="d-block card-header py-3" data-toggle="collapse" role="button" aria-expanded="true" aria-controls="collapseCardExample">
        <h6 class="m-0 font-weight-bold text-primary">User Registrartion</h6>
    </a>
    <!-- Card Content - Collapse -->
    <div class="collapse show" id="collapseCardExample" style="">
        <div class="card-body">

            <form id="userInfo" novalidate=""> 
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="FirstName" class="col-sm-3 col-form-label">First Name <em class="text-danger">*</em></label>
                        @*<input type="text" class="form-control capital" id="FirstName" name="FirstName" required>*@
                        <input type="text" class="form-control" id="FirstName" name="FirstName" placeholder="FIRST NAME" required>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="LastName" class="col-sm-3 col-form-label">Last Name <em class="text-danger">*</em></label>
                        <input type="text" class="form-control" id="LastName" name="LastName" placeholder="LAST NAME" required>

                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="staticEmail" class="col-sm-3 col-form-label">Email <em class="text-danger">*</em></label>

                        <input type="email" class="form-control" name="Email" id="Email" placeholder="example@domain.com" onchange="emailValidation()" required>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="Phone" class="col-sm-3 col-form-label">Phone <em class="text-danger">*</em></label>
                        <input type="text" id="PhoneNumber" name="Phone" maxlength="10" placeholder="0542456789" required onchange="validateMobile()" class="form-control">

                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="staticEmail" class="col-sm-3 col-form-label">Date of Birth <em class="text-danger">*</em></label>
                        <input type="date" id="DateOfBirth" name="DateOfBirth" required onchange="_calculateAge()" class="form-control">
                    </div>
                    <div class="form-group col-md-6">
                        <label for="staticEmail" class="col-sm-3 col-form-label">Company <em class="text-danger">*</em></label>
                        <input type="text" class="form-control" id="Company" name="Company" placeholder="COMPANY NAME" required>

                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="staticEmail" class="col-sm-3 col-form-label">Designation <em class="text-danger">*</em></label>
                        <input type="text" class="form-control" id="Designation" name="Designation" placeholder="DESIGNATION" required>
                    </div>
                </div>

                <hr class="sidebar-divider d-none d-md-block">

                <h3 class="m-0 font-weight-bold text-primary">User Login Info</h3> <br />
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label>User Name  <code>*</code></label>
                            <input type="text" class="form-control" name="UserName" id="Username" required placeholder="Enter User Name">
                        </div>
                    </div> 
                      <div class="col-md-4">
                        <div class="form-group">
                            <label>Roles </label>
                            <div id="productsDataSource"></div>
                            <input hidden id="productsDataSource" name="Role" />
                        </div>
                    </div>
                      <div class="col-md-4">
                            <div class="form-group">
                                <label>Regions </label>
                                <div id="userRegions"></div>
                             </div>
                        </div>
                </div>
                 

                <hr class="sidebar-divider d-none d-md-block">
                <div class="row">
                    <div class="col-md-4"></div>
                    <div class="col-md-4">
                        <button type="button" class="btn btn-info" onclick="onSubmit()">Save</button>
                        <button type="reset" class="btn btn-secondary">Reset</button>
                    </div>
                    <div class="col-md-4"></div>
                </div>
            </form>

        </div>
    </div>
</div>


